<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTU Front Tracker (Visual Arrows)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        :root { --bg: #121212; --card: #1e1e24; --text: #e0e0e0; --accent: #00d2d3; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin:0; padding:20px; }
        
        .container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; max-width: 1600px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 8px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .card-header { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; font-weight: bold; color: #ccc; }
        .meta { font-size: 0.8rem; color: #888; margin-bottom: 5px; font-style: italic; }
        canvas { width: 100% !important; height: 300px !important; }
    </style>
</head>
<body>

<div style="text-align:center; margin-bottom:20px;">
    <h1>GTU Front Tracker</h1>
    <div style="color:#aaa;">Visual Wind Shift Edition</div>
</div>

<div class="container">

    <!-- 1. WIND SHIFT (Modified with Arrows) -->
    <div class="card">
        <div class="card-header">1. Wind Direction & Speed</div>
        <div class="meta">Triangles show wind direction. <br>Look for arrows flipping (e.g., from Up to Down).</div>
        <canvas id="windChart"></canvas>
    </div>

    <!-- 2. THERMODYNAMICS -->
    <div class="card">
        <div class="card-header">2. Temp (Red) & Dewpoint (Blue)</div>
        <div class="meta">Front arrives when the gap widens instantly.</div>
        <canvas id="tempChart"></canvas>
    </div>

    <!-- 3. PRESSURE -->
    <div class="card">
        <div class="card-header">3. Pressure (Purple)</div>
        <div class="meta">Front arrives at the "V" bottom of pressure.</div>
        <canvas id="pressChart"></canvas>
    </div>

</div>

<script>
    const LAT = 30.678; const LON = -97.679;
    const API = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,dewpoint_2m,precipitation,surface_pressure,cloud_cover,wind_speed_10m,wind_gusts_10m,wind_direction_10m&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto&forecast_days=2`;

    async function init() {
        const res = await fetch(API);
        const data = await res.json();
        renderCharts(data.hourly);
    }

    function renderCharts(hourly) {
        const labels = hourly.time.map(t => new Date(t).toLocaleTimeString([], {weekday:'short', hour:'numeric'}));
        
        const common = {
            responsive: true, maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            scales: { x: { ticks:{color:'#888'}, grid:{color:'#333'} }, y: { ticks:{color:'#888'}, grid:{color:'#333'} } },
            plugins: { legend: { labels:{color:'#fff'} } }
        };

        // --- WIND CHART WITH ARROWS ---
        new Chart(document.getElementById('windChart'), {
            data: { 
                labels, 
                datasets: [
                    { 
                        type:'line', 
                        label:'Wind Gusts (Arrows = Direction)', 
                        data:hourly.wind_gusts_10m, 
                        borderColor:'#f1c40f', 
                        borderWidth:2, 
                        
                        // ARROW LOGIC
                        pointStyle: 'triangle', // Shape of the point
                        pointRadius: 6,         // Size of the arrow
                        pointBackgroundColor: '#f1c40f',
                        // Rotate the triangle based on wind direction data
                        rotation: hourly.wind_direction_10m.map(d => d + 180) // +180 to point "with" the wind
                    },
                    { 
                        type:'bar', 
                        label:'Precip (in)', 
                        data:hourly.precipitation, 
                        backgroundColor:'#3498db', 
                        yAxisID:'y1' 
                    }
                ]
            },
            options: {
                ...common,
                scales: { 
                    ...common.scales, 
                    y1: { position:'right', grid:{drawOnChartArea:false} } 
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            afterLabel: function(context) {
                                if (context.dataset.type === 'line') {
                                    const dir = hourly.wind_direction_10m[context.dataIndex];
                                    return `Direction: ${dir}Â° (${valToDir(dir)})`;
                                }
                            }
                        }
                    }
                }
            }
        });

        // --- TEMP CHART ---
        new Chart(document.getElementById('tempChart'), {
            type: 'line',
            data: { labels, datasets: [
                { label:'Temp', data:hourly.temperature_2m, borderColor:'#ff6b6b', borderWidth:3, pointRadius:0, tension:0.4 },
                { label:'Dewpoint', data:hourly.dewpoint_2m, borderColor:'#4ecdc4', borderWidth:2, borderDash:[5,5], pointRadius:0 }
            ]}, options: common
        });

        // --- PRESSURE CHART ---
        new Chart(document.getElementById('pressChart'), {
            type: 'line',
            data: { labels, datasets: [
                { label:'Pressure (hPa)', data:hourly.surface_pressure, borderColor:'#a29bfe', borderWidth:3, pointRadius:0, tension:0.4, yAxisID:'y' }
            ]},
            options: common
        });
    }

    function valToDir(d) {
        const dirs = ['N','NE','E','SE','S','SW','W','NW'];
        return dirs[Math.round(d / 45) % 8];
    }

    init();
</script>

</body>
</html>
