<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vizcaya Community Mobile Weather</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg:#e6f0ff;
  --card:#ffffff;
  --text:#102a43;
  --accent:#005a9e;
  --muted:#5c6c80;
  --border:#b3c7e6;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:radial-gradient(circle at top,#f5fbff 0,#e6f0ff 40%,#d4e2ff 100%);
  color:var(--text);
}
main{max-width:900px;margin:auto;padding:.75rem;}
header{
  text-align:center;
  padding:.75rem;
  border-radius:.75rem;
  background:linear-gradient(135deg,#005a9e,#2196f3,#64b5f6);
  color:#fff;
  box-shadow:0 3px 8px rgba(0,0,0,.2);
}
section{
  background:var(--card);
  margin:.75rem 0;
  padding:.75rem;
  border-radius:.6rem;
  border:1px solid var(--border);
  box-shadow:0 2px 5px rgba(0,0,0,.12);
}
h2{margin:.3rem 0;color:var(--accent);}
.section-tagline{font-size:.85rem;color:var(--muted);margin-bottom:.4rem;}
.embed-wrapper img, iframe{
  width:100%;
  border-radius:.5rem;
}
.alert-box{
  background:#ffe8e8;
  border-left:5px solid #c62828;
  padding:.5rem;
  margin-bottom:.5rem;
  border-radius:.4rem;
}
.footer-note{
  font-size:.85rem;
  text-align:center;
  color:var(--muted);
  margin-top:1rem;
}
</style>
</head>

<body>
<main>

<header>
<h1>Vizcaya Community Mobile Weather</h1>
<div id="liveDateTime"></div>
<div>Georgetown, Texas</div>
</header>

<!-- ALERTS -->
<section>
<h2>Local NWS Alerts</h2>
<div class="section-tagline">Williamson County watches & warnings</div>
<div id="alerts">Loading alerts...</div>
</section>

<!-- STATION -->
<section>
<h2>Live Vizcaya Weather Station</h2>
<div class="section-tagline">Powered by WeatherLink</div>

<iframe
src="https://www.weatherlink.com/embeddablePage/show/9bbf4c3bf5064d48aeb400f026712926/wide"
height="500"
frameborder="0"
scrolling="no">
</iframe>

</section>

<!-- FORECAST -->
<section>
<h2>7-Day Forecast</h2>
<div class="section-tagline">Official forecast from NWS Austin/San Antonio</div>
<div id="forecast">Loading forecast...</div>
</section>

<!-- RADAR -->
<section>
<h2>Central Texas Radar Loop</h2>
<div class="embed-wrapper">
<img id="radarImg"
src="https://radar.weather.gov/ridge/standard/KGRK_loop.gif"
alt="KGRK Radar Loop">
</div>
</section>

<!-- SATELLITE -->
<section>
<h2>Southern Plains Satellite</h2>
<div class="embed-wrapper">
<img id="satImg"
src="https://cdn.star.nesdis.noaa.gov/GOES19/GLM/SECTOR/sp/EXTENT3/1200x1200.jpg"
alt="Southern Plains Satellite">
</div>
</section>

<!-- WPC -->
<section>
<h2>WPC National Forecast Charts</h2>

<div class="embed-wrapper">
<h3>Day 1</h3>
<img id="wpc1"
src="https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad1.png">
</div>

<div class="embed-wrapper">
<h3>Day 2</h3>
<img id="wpc2"
src="https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad2.png">
</div>

<div class="embed-wrapper">
<h3>Day 3</h3>
<img id="wpc3"
src="https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad3.png">
</div>

</section>

<div class="footer-note">
Data & imagery © NWS, NOAA, WPC, NESDIS STAR
</div>

</main>

<script>

// ======================
// LIVE CLOCK
// ======================
function updateClock(){
  const now = new Date();
  document.getElementById("liveDateTime").innerText =
    now.toLocaleDateString("en-US",{weekday:'long',year:'numeric',month:'long',day:'numeric'}) +
    " · " +
    now.toLocaleTimeString("en-US",{hour:'2-digit',minute:'2-digit'});
}
updateClock();
setInterval(updateClock,60000);

// ======================
// NWS FORECAST
// ======================
const lat=30.6333;
const lon=-97.6772;

async function loadForecast(){
  try{
    const p=await fetch(`https://api.weather.gov/points/${lat},${lon}`,{cache:"no-store"});
    const pdata=await p.json();
    const f=await fetch(pdata.properties.forecast,{cache:"no-store"});
    const fdata=await f.json();
    const periods=fdata.properties.periods.slice(0,7);
    let html="";
    periods.forEach(p=>{
      html+=`<div style="margin-bottom:.5rem;"><strong>${p.name}:</strong> ${p.detailedForecast}</div>`;
    });
    document.getElementById("forecast").innerHTML=html;
  }catch(e){
    document.getElementById("forecast").innerText="Forecast unavailable.";
  }
}
loadForecast();
setInterval(loadForecast,1800000);

// ======================
// NWS ALERTS
// ======================
async function loadAlerts(){
  try{
    const res=await fetch(`https://api.weather.gov/alerts/active?zone=TXZ171`,{cache:"no-store"});
    const data=await res.json();
    if(data.features.length===0){
      document.getElementById("alerts").innerHTML="No active alerts.";
      return;
    }
    let html="";
    data.features.forEach(a=>{
      html+=`<div class="alert-box"><strong>${a.properties.headline}</strong><br>${a.properties.description}</div>`;
    });
    document.getElementById("alerts").innerHTML=html;
  }catch(e){
    document.getElementById("alerts").innerText="Alert data unavailable.";
  }
}
loadAlerts();
setInterval(loadAlerts,600000);

// ======================
// FORCE IMAGE REFRESH
// ======================
setInterval(()=>{
  document.getElementById("radarImg").src=
    "https://radar.weather.gov/ridge/standard/KGRK_loop.gif?"+Date.now();
  document.getElementById("satImg").src=
    "https://cdn.star.nesdis.noaa.gov/GOES19/GLM/SECTOR/sp/EXTENT3/1200x1200.jpg?"+Date.now();
  document.getElementById("wpc1").src=
    "https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad1.png?"+Date.now();
  document.getElementById("wpc2").src=
    "https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad2.png?"+Date.now();
  document.getElementById("wpc3").src=
    "https://www.wpc.ncep.noaa.gov/NationalForecastChart/staticmaps/noaad3.png?"+Date.now();
},300000);

</script>

</body>
</html>

